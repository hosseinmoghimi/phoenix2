{% extends "projectmanager/page.html" %}
{% load to_persian_date %}
{% load static %}
{% block child_content %}
<div class="row rtl" id="org-unit-app">
  <div class="col-md-6">
    <div class="card">
      <div class="card-header ">
        <h4 class="card-title farsi text-right">زیرمجموعه ها -
          <small class="description">صفحه های جزیی</small>
        </h4>
      </div>
      <div class="card-body ">





        <template v-for="organizationunit in organizationunits">
          <div v-html="organizationunit.get_link"></div>


        </template>
        {% if add_organizationunit_form %}
        <form class="mt-5 mx-5" @submit.prevent="add_organizationunit">
          <div class="form-group bmd-form-group">
            <label for="exampleInput1" class="bmd-label-floating">نام پروژه زیرمجموعه جدید</label>

            <input type="hidden" name="parent_id" value="{{page.id}}">
            <input v-model="organizationunit_title" type="text" class="form-control" name="title" required=""
              aria-required="true">


          </div>
          <button type="submit" class="btn btn-rose btn-round">افزودن</button>
        </form>
        {% endif %}


      </div>
    </div>






  </div>




</div>

{% endblock  %}

{% block child_script %}

<script src="{% static 'persian/moment.js' %}"></script>
<script src="{% static 'persian/moment-jalaali.js' %}"></script>
<script src="{% static 'persian/vue-persian-datetime-picker-browser.js' %}"></script>

<script>

  $("#nav-item-projectmanager-organizationunits").addClass('active')

  let org_unit_id = JSON.parse("{{organizationunit.id}}")
  var current_date = '{{current_date}}'
  let org_unit_app = new Vue({
    el: "#org-unit-app",
    data: {
      selected_date: current_date,
      organizationunits: JSON.parse(`{{organizationunits_s|escapejs}}`),
      organizationunit_title: '',
    },
    components: {
      DatePicker: VuePersianDatetimePicker
    },
    methods: {
      add_organizationunit: function () {
        let url = "{% url 'projectmanager:add_organizationunit' %}"

        var posting = $.post(url,
          {
            parent_id: org_unit_id,
            title: org_unit_app.organizationunit_title,
            csrfmiddlewaretoken: csrfmiddlewaretoken
          }
        );

        // Put the results in a div
        posting.done(function (data) {

          // word_app.word = (data.word);
          // word_app.definitions = (data.definitions);
          if (data.result === 'SUCCEED') {
            org_unit_app.organizationunit_title = ""
            org_unit_app.organizationunits.push(data.organizationunit)
          }
        })
      },
    },
  })
</script>





{% endblock %}